language: android
sudo: required
dist: xenial

branches:
  only:
  - android-5.1

addons:
  artifacts: true
  apt:
    update: true
    
cache:
  directories:
    - /home/travis/omni

before_install:
  - sudo apt-get update
  - sudo apt-get install -y --no-install-recommends git-core gnupg flex bison gperf build-essential zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 lib32ncurses5-dev x11proto-core-dev libx11-dev lib32z-dev ccache libgl1-mesa-dev libxml2-utils xsltproc unzip maven schedtool rsync make python lzop bc oracle-java8-installer

before_script:
  - git clone https://gitlab.com/ElXreno/android-5.1-src ~/omni
  - cd ~/omni
  - rm -rf device/meizu out
  - mkdir -p device/meizu
  - mv ~/build/ElXreno/twrp_device_meizu_m3s device/meizu/m3s

script:
  - source build/envsetup.sh
  - lunch omni_m3s-eng
  - make -j8
  - cp out/target/product/m3s/recovery.img ~/
  - make clean
  
deploy:
  provider: releases
  api_key: ${DEPLOY_API_KEY}
  file: "/home/travis/recovery.img"
  skip_cleanup: true
  on:
    tags: true
